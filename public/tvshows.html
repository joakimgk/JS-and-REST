<html>
<head>
  <title>tvshows</title>
  <script
  src="https://code.jquery.com/jquery-3.1.1.js"
  integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
  crossorigin="anonymous"></script>
</head>
<body>
  <h1>tvshows jQuery</h1>

  <script type = "text/javascript" language = "javascript">
    $(document).ready(function() {

       $("#driver").click(function(event){
         oppdaterData();
       });


       function createTableRow(cells) {
           var tds = cells.map(function (cellContent) {
               return '<td>' + cellContent + '</td>';
           }).join('');
           return '<tr>' + tds + '</tr>';
       }


       function oppdaterData() {
         console.log("oppdaterData()");
         $.get(
            "/tvshow",
            null,
            function(data) {

              $('#stage').html(null);

              if (data === undefined || data === null)
                  return;
               var tbl=$('<table></table>');

               // lag header
               var tr=$('<tr></tr>');
               $.each(data[0], function(k, v){
                   $('<th>'+k+'</th>').appendTo(tr);
               });
               tr.appendTo(tbl);

               // lag (klikkbare) rader
                $.each(data, function(key, val) {
                    var tr=$('<tr class="tvshow" id=' + val.id + '></tr>');
                    $.each(val, function(k, v){
                        $('<td>'+v+'</td>').appendTo(tr);
                    });
                    tr.appendTo(tbl);
                });

                tbl.appendTo('#stage');
            });
       }

       $("tr").click(function(event) {
          console.log("klikk");
       });

       $("#lagre").click(function(event){
         console.log("lagre()");
         const vname = $("#navn").val();
         const vgenre = $("#genre").val();
         const data = {
           navn: vname,
           genre: vgenre
         };
         $.ajax({
            url: '/tvshow',
            type: 'POST',
            data: data,
            success: function(result) {
                console.log("OK: result = " + result);
                oppdaterData();  // refresh view
            }
        });
       });

       $("#slett").click(function(event){
         const deleteId = $("#delId").val();
         console.log("slett(" + deleteId + ")");
         if (deleteId == "") {
            alert("Du m√• oppgi en ID for sletting");
            return false;
          }
         $.ajax({
            url: '/tvshow/' + deleteId,
            type: 'DELETE',
            success: function(result) {
                console.log("OK: result = " + result);
                oppdaterData();
            }
        });
       });





       // initiell last
       oppdaterData();
    });


 </script>

 <p>Tilgjengelige tv-show:</p>


 <div id="stage" style="background-color:#cc0;">
 </div>

 <div><input type = "button" id = "driver"
    value = "Oppfrisk" /></div>

    <hr/>
  <b>Sett inn nytt show</b>
  <form>
    ID: <span id="showID"></span><br/>
    Navn: <input type="text" name="navn" id="navn"><br/>
    Sjanger: <input type="text" name="genre" id="genre"><br/>
    <input type="button" name="action" value="Lagre" id="lagre"/>
    <hr/>

    <input type="button" name="action" value="Slett" id="slett" />
    id: <input type="text" name="delId" id="delId" size="1">
  </form>
</body>
</html>
